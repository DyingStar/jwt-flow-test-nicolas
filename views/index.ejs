<!DOCTYPE html>
<html lang="en">

<head>
	<title>Login to Salesforce </title>
	<link href="css/bootstrap.min.css" rel="stylesheet">
	<link href="css/custom.css" rel="stylesheet">
	<link rel="icon" type="image/icon" href="Cloud Red.ico" />
	
	<script type="text/javascript" src="lib/jquery.js"></script>
	<script type="text/javascript" src="lib/jqueryCookies.js"> </script>
	<script type="text/javascript" src="lib/bootstrap.min.js"> </script>

	<script>
			
		function clearAllCookies() {
			$.cookie("AccToken", '');
			$.cookie("APIVer", '');
			$.cookie("InstURL", '');
			$.cookie("idURL", '');
			$.cookie("LoggeduserId", '');
		}

		function initialiseButtons() {

			$("#prodBtn").click(function () {
				window.location = 'uAgent?isSandbox=false';
			});
			$("#sandBtn").click(function () {
				window.location = 'uAgent?isSandbox=true';
			});

			$("#prodBtnDvc").click(function () {
				window.location = 'device?isSandbox=false';
			});
			$("#sandBtnDvc").click(function () {
				window.location = 'device?isSandbox=true';
			});

			$("#prodBtnWS").click(function () {
				window.location = 'webServer?isSandbox=false';
			});
			$("#sandBtnWS").click(function () {
				window.location = 'webServer?isSandbox=true';
			});

			$("#prodBtnR").click(function () {
				window.location = 'jwt?isSandbox=false&jwtUserName=' + $("#jwtUserName").val();
			});
			$("#sandBtnR").click(function () {
				window.location = 'jwt?isSandbox=true&jwtUserName=' + $("#jwtUserName").val();
			});
		}
		
		function onload() {
			clearAllCookies();
			initialiseButtons();
		}

		window.onload = onload;
	</script>
</head>

<body class="container" style="padding-top: 50px;" onload="onload()">
	
	<!-- Navigation pane on top of page -->
	<nav role="navigation" class="navbar navbar-default navbar-fixed-top navbar-inverse">
		<div class="container">
			<div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
				<ul class="nav navbar-nav">
					<li>
						<a href="#divHome">Home</a>
					</li>
					<li>
						<a href="#userAgentFlow">UserAgent</a>
					</li>
					<li>
						<a href="#webServer">Web Server</a>
					</li>
					<li>
						<a href="#jwt">JWT</a>
					</li>
					<li>
						<a href="#usernamePassword">Username Password</a>
					</li>
					<li>
						<a href="#deviceFlow">Device Authentication Flow </a>
					</li>
					<li>
						<a href="#refreshToken">Refresh Token</a>
					</li>
					<li>
						<a href="#samlAssertion">SAML Assertion</a>
					</li>
				</ul>
			</div>
		</div>
	</nav>

	<!-- Title and description -->
	<div class="jumbotron" Id="divHome">
		<h1>Salesforce OAuth Flows</h1>

		<div style="display:flex">
			<div style="width:80%;float:left">
				<b> Salesforce - Node.js app for testing OAuth Flows</b> 
				<br /> by <a href="https://www.linkedin.com/in/nicolas-vanden-bossche">Nicolas Vanden Bossche</a>, based on template by Jitendra Zaa.
			</div>
			<div style="width:20%;float:right">
				<img style="height:inherit" src="Salesforce.png" />
			</div>
		</div>
		<!-- Commented because to be moved somewhere else
			<div style="display: block; width:100%">
				<b>Tips : </b> 
				<ol>
					<li>If the user is never redirected to login at Salesforce in flows like JWT or Username password, the user canâ€™t directly authorize the application, so no refresh tokens can be used. If your application requires refresh tokens, you should consider using the Web server or <a href="https://developer.salesforce.com/docs/atlas.en-us.api_rest.meta/api_rest/intro_understanding_username_password_oauth_flow.htm">user-agent OAuth flow</a> or Device Authentication Flow	.</li>
				</ol>
			</div>
		-->
	</div>

	<div class="jumbotron" id="userAgentFlow">
		<h2> User Agent Flow</h2>
		<button type="button" class="btn btn-info" data-toggle="collapse" data-target="#userAgentCollapse">Show/Hide</button>
		
		<div id="userAgentCollapse" class="collapse in">
			<ol class="smallFont">
				<li>
					This page contains a JavaScript application that will use the <a href="https://help.salesforce.com/articleView?id=remoteaccess_oauth_user_agent_flow.htm&type=5&sfdcIFrameOrigin=null"> OAuth 2.0 User-Agent flow</a>
				</li>
				<li> Upon clicking the button, the user is redirected to Salesforce to the Authorization Endpoint using GET method with the following parameters:
					<ul>
						<li><code>response_type=token</code> OR <code>response_type=token%20id_token</code></li>
						<li><code>client_id=&lt;Connected App client_id&gt;</code></li>
						<li><code>redirect_uri=<%= callbackURL %></code></li>
						<li><code>scope=&lt;Connected App client_id&gt;</code> (optional - uses scope defined in Connected App if not specified)</li>
						<li><code>state=&lt;UniqueIdentifier&gt;</code> (prevents CSRF - other websites sending on behalf of this one)</li>
						<li><code>nonce=&lt;highEntropyCode&gt;</code> (prevents replay attack for Open ID)</li>
					</ul>
				</li>
				<li>Salesforce requests the user to log in and authorize the Connected App (this Node.js application)</li>
				<li>After successful authorization, Salesforce redirects to the callback URL (<%= callbackURL %>), passing along the Access Token.</li>
				<li> The callback page parses the returned data
					<ul>
							<li><code>access_token=00D...</code></li>
							<li><code>token_type=Bearer</code></li>
							<li><code>id_token=...</code> (contains information about the user's identity - only when specifying <code>openid</code> scope</li>
							<li><code>refresh_token=...</code></li>
							<li><code>instance_url=<%= baseURL %></code></li>
							<li><code>id=&lt;Identity URL&gt;</code></li>
							<li><code>signature=...</code> (client_secret key applied to id:issued_at - optional)</li>
					</ul>
				</li>
			</ol>
		</div>
		<div>
			<a id="prodBtn" role="button" style="margin-right:40px" class="btn btn-primary btn-lg">Production</a>
			<a id="sandBtn" role="button" class="btn btn-primary btn-lg">Sandbox</a>
		</div>
	</div>
	<div class="jumbotron" id="webServer">
		<p>
			<h2>Web Server Flow </h2>
			<ol class="smallFont">
				<li> This page (Index.html) </li>
				<li> Salesforce
					<b>authorize</b> URL, response type
					<b>code</b>
				</li>
				<li> oauthCallback.html</li>
				<li> Salesforce
					<b>token</b> URL, grant_type
					<b>authorization_code</b>, POST request </li>
				<li>Main.html (Salesforce Query operations) </li>
			</ol>
			<a id="prodBtnWS" role="button" style="margin-right:40px" class="btn btn-primary btn-lg">Production</a>
			<a id="sandBtnWS" role="button" class="btn btn-primary btn-lg">Sandbox</a>
		</p>
	</div>
	


	<div class="jumbotron" id="jwt">
		<p>
			<h2> JWT OAuth Flow </h2>

			<p>
				<i class="note">
					<a href="https://jwt.io/"> Use this tool to debug JSON token generated in Node.js application. </a>
				</i>
			</p>

			<ol class="smallFont">
				<li> This page (Index.html) </li>
				<li> Salesforce
					<b>token</b> URL, grant type
					<b>jwt-bearer</b> , POST request </li>
				<li> Main.html (Salesforce Query operations) </li>
			</ol>



			<div class="form-group">
				<label for="jwtUserName">Salesforce username previously validated Connected App </label>
				<input class="form-control" id="jwtUserName" type="text" value="ilovenagpur@gmail.com" />
			</div>

			<a id="prodBtnR" role="button" style="margin-right:40px" class="btn btn-primary btn-lg">Production</a>
			<a id="sandBtnR" role="button" class="btn btn-primary btn-lg">Sandbox</a>
		</p>


	</div>

	<div class="jumbotron" id="usernamePassword">
		<p>
			<h2>Username - Password OAuth Flow </h2>

			<ol class="smallFont">
				<li> This page (Index.html) </li>
				<li> Salesforce
					<b>token</b> URL, grant type
					<b>password</b> , POST request </li>
				<li> Main.html (Salesforce Query operations) </li>
			</ol>

			<form action="/uPwd" method="POST" name="usernamepasswordFlow">
				<div class="form-group">
					<label for="sfdcUsername">Salesforce Username </label>
					<input class="form-control" name="sfdcUsername"  id="sfdcUsername" type="text" value="ilovenagpur@gmail.com" />

					<label for="sfdcPassword">Salesforce Password </label>
					<input class="form-control"  name="sfdcPassword" id="sfdcPassword" type="password" value="" />
					<br>
					<button class="btn btn-primary btn-lg" type="submit" name="instance" value="prod">Production</button>
					<button class="btn btn-primary btn-lg" type="submit" name="instance" value="sand">Sandbox</button>
				</div>
			</form>
		</p>  
	</div>

	<div class="jumbotron" id="deviceFlow">
			<p>
				<h2> Device Authentication Flow</h2>
	
				<ol class="smallFont">
					<li> Make sure Device Authentication flow is enabled in Connected App</li>
					<li> This page (Index.html) </li>
					<li> Salesforce
						<b>token</b> URL, response type
						<b>device_code, POST request</b>
					</li>
					<li>Validate device by navigating URL and providing code</li>
					<li>Meanwhile, keep polling <b>token</b> URL with device code and grant type <b>device</b></li> 
					<li>extract <b>access_token</b></li>
					<li> Main.html (Salesforce Query operations) </li>
				</ol>
	
				<a id="prodBtnDvc" role="button" style="margin-right:40px" class="btn btn-primary btn-lg">Production</a>
				<a id="sandBtnDvc" role="button" class="btn btn-primary btn-lg">Sandbox</a>
			</p>
		</div>

	<div class="jumbotron" id="refreshToken">
		<p>
			<h2>Refresh Token Flow</h2>
			<p><i><b> To be Implemented </b>	</i></p>
			Refresh Token flow can only be implemented for OAuth which asks users confirmation to validate connected app like Web Server flow and User Agent Flow 
		</p>
	</div>

	<div class="jumbotron" id="samlAssertion">
			<p>
				<h2>SAML Assertion Flow </h2>
				<p><i><b> To be Implemented </b>	</i></p>   
			</p>
		</div>


	

</body>

</html>